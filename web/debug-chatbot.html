<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Chatbot - JobWala</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .debug-container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .debug-item { margin: 10px 0; padding: 10px; background: #f8f9fa; border-left: 4px solid #007bff; }
        .debug-item.success { border-left-color: #28a745; background: #d4edda; }
        .debug-item.error { border-left-color: #dc3545; background: #f8d7da; }
        .debug-item.warning { border-left-color: #ffc107; background: #fff3cd; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .chatbot-preview { position: fixed; bottom: 20px; right: 20px; z-index: 9999; }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ðŸ”§ Chatbot Debug Tool</h1>
        
        <div class="debug-item" id="page-check">
            <strong>Page Check:</strong> <span id="page-status">Checking...</span>
        </div>
        
        <div class="debug-item" id="script-check">
            <strong>Script Load Check:</strong> <span id="script-status">Checking...</span>
        </div>
        
        <div class="debug-item" id="widget-check">
            <strong>Widget Creation Check:</strong> <span id="widget-status">Checking...</span>
        </div>
        
        <div class="debug-item" id="styles-check">
            <strong>Styles Check:</strong> <span id="styles-status">Checking...</span>
        </div>
        
        <div class="debug-item" id="events-check">
            <strong>Event Listeners Check:</strong> <span id="events-status">Checking...</span>
        </div>
        
        <h3>Actions:</h3>
        <button onclick="forceInit()">Force Initialize Chatbot</button>
        <button onclick="checkStatus()">Refresh Status</button>
        <button onclick="openChatbot()">Open Chatbot</button>
        <button onclick="closeChatbot()">Close Chatbot</button>
        <button onclick="testMessage()">Send Test Message</button>
        
        <h3>Console Logs:</h3>
        <div id="console-logs" style="background: #000; color: #0f0; padding: 10px; border-radius: 5px; font-family: monospace; height: 200px; overflow-y: auto;"></div>
    </div>

    <!-- Load the chatbot integration script -->
    <script src="js/chatbot-integration.js"></script>
    
    <script>
        // Override console.log to capture logs
        const originalLog = console.log;
        const logContainer = document.getElementById('console-logs');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const logEntry = document.createElement('div');
            logEntry.textContent = args.join(' ');
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        };
        
        function checkStatus() {
            console.log('=== Debug Check Started ===');
            
            // Page check
            const currentPage = window.location.pathname.split('/').pop();
            const restrictedPages = ['user-dashboard.html', 'company-dashboard.html', 'consultancy-dashboard.html', 'admin.html', 'dashboard.html'];
            const shouldShow = !restrictedPages.some(page => currentPage === page || window.location.pathname.includes(page));
            
            document.getElementById('page-status').textContent = `Current: ${currentPage}, Should Show: ${shouldShow}`;
            document.getElementById('page-check').className = shouldShow ? 'debug-item success' : 'debug-item warning';
            
            // Script check
            const scriptLoaded = window.simpleChatbotLoaded;
            document.getElementById('script-status').textContent = scriptLoaded ? 'Loaded' : 'Not Loaded';
            document.getElementById('script-check').className = scriptLoaded ? 'debug-item success' : 'debug-item error';
            
            // Widget check
            const widget = document.getElementById('simple-chatbot-widget');
            document.getElementById('widget-status').textContent = widget ? 'Created' : 'Not Found';
            document.getElementById('widget-check').className = widget ? 'debug-item success' : 'debug-item error';
            
            // Styles check
            const styles = document.getElementById('simple-chatbot-styles');
            document.getElementById('styles-status').textContent = styles ? 'Loaded' : 'Not Found';
            document.getElementById('styles-check').className = styles ? 'debug-item success' : 'debug-item error';
            
            // Events check
            const toggle = document.getElementById('simple-chatbot-toggle');
            const hasEvents = toggle && toggle.onclick !== null;
            document.getElementById('events-status').textContent = hasEvents ? 'Attached' : 'Not Attached';
            document.getElementById('events-check').className = hasEvents ? 'debug-item success' : 'debug-item error';
            
            console.log('Debug check completed');
        }
        
        function forceInit() {
            console.log('Force initializing chatbot...');
            if (window.simpleChatbotLoaded) {
                console.log('Chatbot already loaded, reinitializing...');
                // Remove existing
                const existing = document.getElementById('simple-chatbot-widget');
                if (existing) existing.remove();
                
                // Re-run the integration script
                eval(document.querySelector('script[src="js/chatbot-integration.js"]').textContent);
            } else {
                console.log('Chatbot not loaded, loading integration script...');
                const script = document.createElement('script');
                script.src = 'js/chatbot-integration.js';
                document.head.appendChild(script);
            }
        }
        
        function openChatbot() {
            if (window.openSimpleChatbot) {
                window.openSimpleChatbot();
                console.log('Chatbot opened');
            } else {
                console.log('openSimpleChatbot function not available');
            }
        }
        
        function closeChatbot() {
            if (window.closeSimpleChatbot) {
                window.closeSimpleChatbot();
                console.log('Chatbot closed');
            } else {
                console.log('closeSimpleChatbot function not available');
            }
        }
        
        function testMessage() {
            const input = document.getElementById('simple-chatbot-input');
            if (input) {
                input.value = 'Hello! This is a test message.';
                input.dispatchEvent(new KeyboardEvent('keypress', { key: 'Enter' }));
                console.log('Test message sent');
            } else {
                console.log('Chatbot input not found');
            }
        }
        
        // Initial check
        setTimeout(checkStatus, 1000);
        
        // Check every 2 seconds
        setInterval(checkStatus, 2000);
    </script>
</body>
</html>
